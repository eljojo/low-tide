# Context
README.md and CONTRIBUTING.md are full of context about this project, they're good reads if you want to gather context.

# Rules
NEVER load up files from /static/ into your context, it only includes the bundled files from /frontend/.
NEVER run the built project binary yourself (i.e `go run`), ask human to do it. BEFORE confirming a bugfix, ALWAYS do a `make build` to ensure things build correctly.
NEVER delete files without confirming with human first. every single time.

# How to test
When working on the project, it's important to run tests and keep them up to date.

For Golang:
- use `go test` to run specific tests, most things go into the high level integration_test.go
- use `make build` to ensure the project builds correctly.
- before confirming golang changes you must build and test
- NEVER call `go run .`, `./low-tide`, or `make run` directly, ask human to do it.

For Frontend (React + Playwright):
- to run all frontend tests do `make test-e2e`, otherwise use `npx playwright test <testfile>` to run specific tests.
- before confirming frontend changes you must run all e2e tests. Make sure to keep them updated!

# Pitfalls to avoid
## Note on special characters
When dealing with special characters/text literals in code, store them in internal/chars/chars.go, and be EXTRA careful when handling that file.
For example: `summaryLine := chars.NewLine + fmt.Sprintf`...

## Server logic
`server.go` handles API routing, WebSocket upgrading, and artifact serving (ZIPs, thumbnails). It relies on `http_helpers.go` for common tasks.

# As the project evolves
**Keep `README.md`, `CONTRIBUTING.md`, and all `.goosehints` up to date when major architectural/product direction changes happen** (not for small additions).

## Repository map

- `main.go`: Application entry point, DB initialization, and service wiring.
- `server.go`: HTTP handlers, WebSocket management, and asset embedding (`static/`, `templates/`).
- `http_helpers.go`: Utility functions for the server (e.g., zip writing, path validation).
- `jobs/`: Core logic: `manager` (queue), `job_execution` (PTY/FS resync), `file_watcher` (artifact tracking), and `state_broadcast` (WS/Snapshots).
- `store/`: SQLite schema and queries.
- `config/`: YAML models, app matching (regex), and URL normalization.
- `frontend/src/`: Preact + Zustand + Wouter. (api.ts, index.tsx, store.ts, and others)
- `frontend/src/components`: FileManifest, JobsList, JobHeader, NewJobForm, SelectedJobPane, TerminalView, ThemeSwitcher, among others.
- `frontend/css/main.css`: Main CSS file.
- `frontend/css/themes/`: archivist, midnight-vinyl, the-broadcaster
- `internal/terminal/`: ANSI-to-HTML conversion and delta update logic.
- `integration_test.go`: High-level Go integration tests.
- `e2e/`: Playwright end-to-end tests for the full stack.

More developer notes are maintained in `CONTRIBUTING.md`.
Detailed hints for specific subdirectories are in their respective `.goosehints` files.


# A note on Nix
We're trying out nix flakes for CI and building containers. If asked to work on flakes or nix, you need to test using `git add flake.nix && nix build .#e2e-tests`. This will take a long time.
